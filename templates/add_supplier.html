{% extends "index.html" %}

{% block content %}
<div id="addSupplierForm" class="bg-white p-6 rounded shadow max-w-xl mx-auto">
  <h2 class="text-2xl font-bold mb-4">Add New Supplier</h2>
  <form id="supplierForm">
    <div class="mb-4">
      <label class="block mb-1 font-medium">Name</label>
      <input type="text" name="name" id="name" placeholder="Enter name" class="w-full px-4 py-2 border rounded" required>
    </div>
    <div class="mb-4">
      <label class="block mb-1 font-medium">Contact</label>
      <input type="tel" name="contact" id="contact" placeholder="Phone number" class="w-full px-4 py-2 border rounded" required>
    </div>
    <div class="mb-4">
      <label class="block mb-1 font-medium">Email</label>
      <input type="email" name="email" id="email" placeholder="Enter supplier's email" class="w-full px-4 py-2 border rounded">
    </div>
    <button type="submit" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded">
      Submit
    </button>
  </form>
</div>

<!-- PocketBase SDK -->
<script src="https://unpkg.com/pocketbase/dist/pocketbase.umd.js"></script>
<script>
  const pb = new PocketBase('http://127.0.0.1:8090');

  document.getElementById("supplierForm").addEventListener("submit", async function (e) {
    e.preventDefault();

    const data = {
      name: document.getElementById("name").value.trim(),
      contact: document.getElementById("contact").value.trim(),
      email: document.getElementById("email").value.trim() || undefined, // Skip if empty
    };

    try {
      await pb.collection("suppliers").create(data);
      alert("Supplier added successfully!");
      window.location.href = "/suppliers";
    } catch (error) {
      console.error("Error details:", error?.response || error);
      alert("Failed to add supplier. Reason: " + (error?.response?.message || JSON.stringify(error?.response) || "Unknown error"));
    }
  });
</script>
{% endblock %}
